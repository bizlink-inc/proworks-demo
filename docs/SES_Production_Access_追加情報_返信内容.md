# SES Production Access 追加情報 - 返信内容

## 概要

AWS サポートケース（Case ID: 176542643100437）に返信するための追加情報です。

## 返信内容（日本語）

---

**件名**: SES Production Access 申請 - 追加情報の提供

---

### 1. メールを送信する頻度

**初期段階（現在）**:

- 1 日あたり: 50-100 通程度
- 送信タイミング: ユーザーのアクション（登録、パスワードリセットリクエスト等）に基づいて即座に送信

**成長期（3-6 ヶ月後）**:

- 1 日あたり: 500-1,000 通程度
- 送信タイミング: 同様にユーザーアクションに基づく即座送信

**最大想定（1 年後）**:

- 1 日あたり: 5,000 通以下
- 送信タイミング: 同様にユーザーアクションに基づく即座送信

**送信パターン**:

- すべてのメールは**トランザクションメール**（ユーザーの明示的なアクションに基づく）
- バッチ送信や一斉配信は行いません
- 送信レートは段階的に増やし、スパムスコアを監視します

---

### 2. 受信者リストのメンテナンス方法

**受信者リストの管理**:

- 受信者リストは、アプリケーションのデータベース（AWS RDS PostgreSQL）に保存されます
- ユーザーが明示的に登録したメールアドレスのみが送信対象となります
- 新規登録時: ユーザーがメールアドレスを入力し、確認メールを送信
- メールアドレス変更時: ユーザーが新しいメールアドレスを入力し、確認メールを送信
- パスワードリセット時: ユーザーがリセットリクエストを送信したメールアドレスにのみ送信

**リストの更新方法**:

- ユーザーがアカウントを削除した場合、データベースから削除
- オプトアウト要求があった場合、データベースにフラグを設定し、以降の送信を停止
- バウンス・苦情が発生した場合、自動的に送信停止リストに追加

**リストの取得元**:

- 外部のメールリストや購入したリストは使用しません
- すべての受信者は、アプリケーションに自ら登録したユーザーのみです

---

### 3. バウンス、申し立て、解除申請の管理方法

**バウンス処理**:

1. **ハードバウンス**:

   - 即座にデータベースの送信停止リストに追加
   - 以降、該当メールアドレスへの送信を完全に停止
   - CloudWatch Logs に記録

2. **ソフトバウンス**:
   - 3 回連続でバウンスした場合、送信停止リストに追加
   - 1-2 回のバウンスは一時的な問題として扱い、再送信を試みます
   - CloudWatch Logs に記録

**苦情（Complaint）処理**:

1. **苦情が発生した場合**:
   - 即座にデータベースの送信停止リストに追加
   - 該当ユーザーに通知（必要に応じて）
   - CloudWatch Logs に記録
   - 以降、該当メールアドレスへの送信を完全に停止

**解除申請（Unsubscribe）処理**:

1. **オプトアウト機能**:
   - すべてのメールに配信停止リンクを記載
   - ユーザーがリンクをクリックすると、データベースにオプトアウトフラグを設定
   - 以降、該当メールアドレスへの送信を完全に停止
   - CloudWatch Logs に記録

**監視とアラート**:

- Amazon SES のバウンス・苦情イベントを SNS トピック経由で CloudWatch に通知
- CloudWatch でバウンス率・苦情率を監視
- 異常な値が検出された場合、アラートを発報
- すべての処理を自動化し、手動介入を最小限に抑えます

---

### 4. 送信する予定のメールのサンプル

**メールタイプ 1: ユーザー登録確認メール**

```
件名: 【PRO WORKS】メールアドレスの確認

本文:
PRO WORKS へのご登録ありがとうございます。

以下のリンクをクリックして、メールアドレスの確認を完了してください。

▶ [確認リンク]

※ このリンクの有効期限は1時間です。
※ このメールに心当たりがない場合は、削除してください。
```

**メールタイプ 2: パスワードリセットメール**

```
件名: 【PRO WORKS】パスワードのリセット

本文:
パスワードリセットのリクエストを受け付けました。

以下のリンクをクリックして、新しいパスワードを設定してください。

▶ [リセットリンク]

※ このリンクの有効期限は1時間です。
※ このリクエストに心当たりがない場合は、このメールを無視してください。パスワードは変更されません。
```

**メールタイプ 3: メールアドレス変更確認メール**

```
件名: 【PRO WORKS】メールアドレス変更の確認

本文:
メールアドレス変更のリクエストを受け付けました。

以下のリンクをクリックして、新しいメールアドレスを確認してください。

▶ [確認リンク]

※ このリンクの有効期限は1時間です。
※ このリクエストに心当たりがない場合は、このメールを無視してください。メールアドレスは変更されません。
```

**メールタイプ 4: 案件マッチング通知メール（今後実装予定）**

```
件名: 【PRO WORKS】新しいマッチング案件があります

本文:
新しいマッチング案件が見つかりました。

詳細を確認するには、以下のリンクをクリックしてください。

▶ [案件詳細リンク]

※ 配信停止をご希望の場合は、[配信停止リンク]をクリックしてください。
```

**すべてのメールに含まれる要素**:

- 送信元: `PRO WORKS <noreply@proworks.jp>`
- 配信停止リンク（オプトアウト機能）
- 日本語での明確な説明
- 個人情報保護法に準拠した内容

---

### 5. 技術的な実装詳細

**アプリケーション構成**:

- AWS App Runner 上で Next.js アプリケーションを実行
- データベース: AWS RDS PostgreSQL
- メール送信: Amazon SES（`@aws-sdk/client-ses`を使用）

**メール送信フロー**:

1. ユーザーがアプリケーションでアクションを実行（登録、パスワードリセットリクエスト等）
2. アプリケーションがデータベースに記録
3. Amazon SES を使用してメールを送信
4. 送信結果を CloudWatch Logs に記録
5. バウンス・苦情は SNS トピック経由で CloudWatch に通知し、自動処理

**コンプライアンス対応**:

- 個人情報保護法に準拠
- メール送信前にユーザーの同意を取得（アプリケーション利用規約への同意）
- オプトアウト要求には即座に対応
- バウンス・苦情のログを保持し、監査に対応可能

---

### 6. ドメイン検証について

**現在の状況**:

- 送信ドメイン `proworks.jp` を SES に追加済み
- ドメイン検証のための DNS レコード設定を準備中

**検証予定の DNS レコード**:

- Domain Verification (TXT レコード): `_amazonses.proworks.jp`
- DKIM (CNAME レコード × 3): `token1._domainkey.proworks.jp`, `token2._domainkey.proworks.jp`, `token3._domainkey.proworks.jp`
- SPF (TXT レコード): `proworks.jp`
- DMARC (TXT レコード): `_dmarc.proworks.jp`

**検証完了予定**: ドメイン検証は、本申請の承認と並行して進めます。

---

以上、ご確認のほどよろしくお願いいたします。
