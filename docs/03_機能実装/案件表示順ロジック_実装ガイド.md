# 案件表示順ロジック

**実装日**: 2025 年 12 月 9 日  
**最終更新**: 2025 年 12 月 9 日（担当者おすすめ・AIマッチ優先表示を実装）

---

## 表示順の種類

案件一覧画面の右上プルダウンで以下の 3 つの表示順を選択可能：

1. **おすすめ順**（デフォルト）
2. **新着順**
3. **金額高い順**

---

## 1. おすすめ順

### 表示ロジック（優先順位順）

おすすめ順では、以下の優先順位でソートされます：

1. **③担当者おすすめ**（最優先）
   - 推薦 DB の「担当者おすすめ」フィールドが「おすすめ」に設定されている案件
   - 担当者おすすめの案件は、他の条件に関わらず最上位に表示されます

2. **②AIマッチ**
   - 推薦 DB の「AIマッチ実行状況」が「実行済み」の案件
   - 担当者おすすめでない場合、AIマッチの案件が次に優先されます

3. **①登録情報マッチ（適合スコア）**
   - 推薦 DB の「適合スコア」が高い順に表示
   - スコアが同じ場合は新着順（作成日時の降順）で表示

### 適合スコアの計算方法

1. 案件の「スキル」「職種\_ポジション」をキーワードとして抽出
2. 人材の以下のフィールドでキーワードの出現回数をカウント：
   - 職種（複数選択）
   - 言語\_ツール
   - 主な実績*PR*職務経歴
3. 全キーワードの出現回数を合計してスコア化

**例**：

- 案件スキル: Python, AWS, React
- 人材の言語\_ツール: "Python, Django, AWS"
- 人材の職務経歴: "Python を使った開発経験 3 年"
- → スコア: Python(2 回) + AWS(1 回) + React(0 回) = 3 点

### バッジ表示

案件カードには以下のバッジが表示されます（左から順）：

- **NEW**（赤色）：新着案件（作成日時が14日以内）
- **担当者おすすめ**（オレンジ色）：担当者おすすめフラグが設定されている案件
- **AIマッチ**（青色）：AIマッチが実行済みの案件

これらのバッジは同時に表示される場合があり、左から「NEW → 担当者おすすめ → AIマッチ」の順に配置されます。

---

## 2. 新着順

案件の作成日時（kintone 標準フィールド）が新しい順に表示

---

## 3. 金額高い順

案件の掲載単価が高い順に表示

---

## 応募済み案件の扱い

応募済みの案件は案件一覧に**表示しない**

- 応募ステータスに関わらず、応募履歴 DB に存在する案件はすべて除外

---

## 表示件数

案件一覧では、**21件毎**にページネーションで表示されます。

- 3列×7行のグリッドレイアウト
- ページ番号で切り替え可能

---

## データソース

- **推薦 DB**: 適合スコア、担当者おすすめフラグ、AIマッチ実行状況を保持（人材 ID × 案件 ID の組み合わせ）
- **案件 DB**: 案件情報（作成日時、掲載単価など）
- **応募履歴 DB**: 応募済み案件の判定に使用

---

---

## シードデータでの表示順確認

`npm run seed:create` で作成されるシードデータを使用して、表示順を確認できます。

### テストユーザー

- **メールアドレス**: `seed_yamada@example.com`
- **パスワード**: `password123`
- **auth_user_id**: `seed_user_001`

### シードデータの構成

#### 案件データ（yamada 用、5 件）

| jobIndex | 案件名                                 | 掲載単価 | 応募状況       | 推薦スコア |
| -------- | -------------------------------------- | -------- | -------------- | ---------- |
| 0        | 大手 EC サイトのフロントエンド刷新案件 | 75 万円  | 応募済み       | 85         |
| 1        | 金融系 Web アプリケーション API 開発   | 80 万円  | 応募済み       | 70         |
| 2        | スタートアップ向け新規サービス開発     | 75 万円  | **表示される** | 90         |
| 3        | ヘルスケアアプリ開発案件               | 72 万円  | **表示される** | 60         |
| 4        | データ基盤構築・運用案件               | 85 万円  | **表示される** | 65         |

※ jobIndex 0, 1 は応募済みのため、案件一覧には表示されません。

### 各表示順での表示順序

#### 1. おすすめ順（デフォルト）

優先順位に従って表示されます：

**優先順位の例**：
1. **担当者おすすめ + AIマッチ + 登録情報マッチ（スコア 95）** - 最優先
2. **担当者おすすめ + 登録情報マッチ（スコア 80）** - 次に優先
3. **AIマッチ + 登録情報マッチ（スコア 90）** - その次
4. **登録情報マッチのみ（スコア 90）** - スコア順
5. **登録情報マッチのみ（スコア 65）** - スコア順
6. **登録情報マッチのみ（スコア 60）** - スコア順

※ 同じ優先順位内では、登録情報マッチのスコアが高い順、同スコアの場合は新着順で表示されます。

#### 2. 新着順

案件の作成日時が新しい順に表示されます：

- 作成順序は kintone での作成順に依存します
- 通常は `npm run seed:create` 実行時の作成順序になります

#### 3. 金額高い順

掲載単価の高い順に表示されます：

1. **データ基盤構築・運用案件**（85 万円）
2. **スタートアップ向け新規サービス開発**（75 万円）
3. **ヘルスケアアプリ開発案件**（72 万円）

### 確認方法

1. `npm run seed:create` を実行してシードデータを作成
2. `seed_yamada@example.com` / `password123` でログイン
3. 案件一覧画面で右上の「表示順」プルダウンから各表示順を選択
4. 上記の順序で表示されることを確認

---

## 更新履歴

| 日時       | 内容                                                         |
| ---------- | ------------------------------------------------------------ |
| 2025-12-09 | 初版作成・おすすめ順/新着順/金額高い順の実装                 |
| 2025-12-09 | シードデータでの表示順確認方法を追加                         |
| 2025-12-09 | 担当者おすすめ・AIマッチ優先表示を実装、バッジ表示を追加     |
| 2025-12-09 | 表示件数を21件毎に変更、おすすめ順の優先順位ロジックを更新   |
