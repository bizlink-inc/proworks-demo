# 案件検索機能 実装ガイド

## 概要

ProWorks の案件検索機能は、複数のフィルター条件を組み合わせて案件を検索できるように設計されています。

**実装日時**: 2025 年 12 月 8 日  
**関連ファイル**:

- `components/dashboard-filters.tsx` - UI コンポーネント
- `components/dashboard-client.tsx` - ロジック
- `app/api/jobs/route.ts` - バックエンド API

---

## 検索ロジック

### 1. キーワード検索（フリーワード）

**検索対象フィールド（Kintone）**:

- 案件名
- 作業内容
- 環境
- 必須スキル
- 尚可スキル
- 案件特徴
- 職種\_ポジション

**検索方式**: 上記のいずれかのフィールドに入力キーワードが**部分一致**すれば該当

**複数キーワード時の動作**: 1 つの文字列として検索（例：「TypeScript React」で検索 → 「TypeScript React」という順序で含まれる案件のみが該当）

**注**: 現在は複数単語の AND 検索非対応。複数キーワードを分割検索したい場合は要改善。

---

### 2. リモート可否フィルター

**選択肢**: フルリモート可 / リモート併用可 / 常駐案件

**検索対象**: Kintone の「案件特徴」フィールド

**複数選択時の動作**: **OR 条件**（選択した項目のいずれかに該当する案件を表示）

**例**: 「フルリモート可」と「リモート併用可」を選択 → 両方を含む案件を表示

---

### 3. 職種/ポジションフィルター

#### マッピング定義

| UI 表示  | マッピング先（Kintone 職種\_ポジション）                      |
| -------- | ------------------------------------------------------------- |
| インフラ | インフラエンジニア                                            |
| PM・PMO  | PM (プロジェクトマネージャー) / PMO (プロジェクト管理支援)    |
| コンサル | SAP コンサルタント / 業務系コンサルタント / IT コンサルタント |
| デザイン | Web デザイナー / UI / UX デザイナー                           |

#### 検索ロジック

マッピング先の値に基づいて、Kintone の職種\_ポジション フィールドを検索。
複数のマッピング値がある場合は、そのうち**いずれか 1 つでも合致**すれば該当。

**例**:
- 「PM・PMO」選択時：「PM (プロジェクトマネージャー)」**OR** 「PMO (プロジェクト管理支援)」に該当する案件を表示
- 「コンサル」選択時：3 つのコンサル職種のいずれかに該当する案件を表示

#### 複数選択時の動作

**OR 条件**（選択した職種のいずれかに該当する案件を表示）

**例**: 「インフラ」と「デザイン」を選択 → (インフラ OR デザイン) に該当する案件を表示

---

### 4. 勤務地エリアフィルター

**検索対象**: Kintone の「勤務地エリア」フィールド

**検索方式**: 入力値が勤務地エリアに**部分一致**すれば該当

**例**: 「東京」と入力 → 「東京都渋谷区」などが該当

---

### 5. 最寄り駅フィルター

**検索対象**: Kintone の「最寄駅」フィールド

**検索方式**: 入力値から「駅」を除去し、最寄駅フィールドからも「駅」を除去した上で**部分一致**

**例**:

- 「渋谷駅」または「渋谷」と入力 → 「渋谷駅」が該当
- 「新宿」と入力 → 「新宿駅」が該当

---

## 複数フィルター間の論理

**複数選択フィルター内**（リモート可否、職種）: **OR 条件**

**異なるフィルター間**（フリーワード + リモート + 職種）: **AND 条件**

**例**: 「TypeScript」で検索 + 「フルリモート可」を選択 + 「開発」を選択
→ （「TypeScript」を含む）**AND** （フルリモート可）**AND** （開発）に該当する案件を表示

---

## 関連ファイル

- `components/dashboard-filters.tsx` - 検索 UI
- `components/dashboard-client.tsx` - 検索ロジック
- `app/api/jobs/route.ts` - API エンドポイント
- `lib/kintone/services/job.ts` - Kintone API 通信
- `lib/kintone/types.ts` - 型定義

---

## 更新履歴

| 日時       | 内容                   |
| ---------- | ---------------------- |
| 2025-12-08 | 初版作成・検索機能実装 |
