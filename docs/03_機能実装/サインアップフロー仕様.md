# サインアップフロー仕様書

## 概要

本ドキュメントでは、ProWorksアプリケーションにおける新規ユーザー登録（サインアップ）から、プロフィール完成までのフローと、各ステップで入力が必要な項目について定義します。

---

## フロー図

```
┌─────────────────────────────────────────────────────────────────────┐
│                         サインアップフロー                           │
└─────────────────────────────────────────────────────────────────────┘

  ┌──────────────────┐
  │  1. 新規登録画面  │
  │  /auth/signup    │
  └────────┬─────────┘
           │
           ▼
  ┌──────────────────┐
  │ 2. メール送信完了 │
  │   （同ページ内）   │
  └────────┬─────────┘
           │
           ▼ メール内リンクをクリック
  ┌──────────────────┐
  │ 3. メール認証     │
  │  /api/auth/callback │
  └────────┬─────────┘
           │
           ▼
  ┌──────────────────────────┐
  │ 4. プロフィール完成画面   │
  │  /auth/complete-profile  │
  │  （中間ページ）           │
  └────────┬─────────────────┘
           │
           ▼
  ┌──────────────────┐
  │  5. マイページ    │
  │     /me          │
  └──────────────────┘
```

---

## 各ステップの詳細

### 1. 新規登録画面（/auth/signup）

**目的**: 基本的なアカウント情報と本人確認情報の収集

| 項目 | 必須 | 入力形式 | 備考 |
|------|:----:|----------|------|
| お名前（姓） | ✅ | テキスト | 例: 山田 |
| お名前（名） | ✅ | テキスト | 例: 太郎 |
| メールアドレス | ✅ | Email | 認証に使用 |
| パスワード | ✅ | パスワード | 8文字以上、半角英数字・記号 |
| 電話番号 | ✅ | Tel | 例: 09011112222 |
| 生年月日 | ✅ | 年月日選択 | プルダウン形式 |
| 新着案件・サービス情報を受け取る | - | チェックボックス | デフォルトON |
| ログイン状態を保持 | - | チェックボックス | 30日間セッション維持 |
| 利用規約・個人情報取扱規約に同意する | ✅ | チェックボックス | 同意必須 |

**送信データ**:
- `lastName`, `firstName`: 氏名
- `email`: メールアドレス
- `password`: パスワード
- `phone`: 電話番号
- `birthDate`: 生年月日（YYYY-MM-DD形式）
- `emailDeliveryStatus`: メール配信設定（"配信中" / "配信停止"）
- `termsAgreed`: 利用規約同意（"同意済み"）
- `rememberMe`: ログイン保持フラグ

---

### 2. メール送信完了（同ページ内）

**表示内容**:
- 認証メール送信完了のメッセージ
- 次のステップの案内
  1. 受信トレイを確認
  2. メール内のリンクをクリック
  3. マイページでプロフィールを記入

---

### 3. メール認証（/api/auth/callback）

**処理内容**:
- メール内リンクのトークン検証
- ユーザーアカウントの有効化
- セッションの作成
- ログイン保持設定の適用（`rememberMe`がtrueの場合は30日間）

**リダイレクト先**: `/auth/complete-profile`

---

### 4. プロフィール完成画面（/auth/complete-profile）【中間ページ】

**目的**: 案件マッチングに最低限必要な情報の収集（離脱を防ぐため項目を絞る）

| 項目 | 必須 | 入力形式 | 備考 |
|------|:----:|----------|------|
| 姓（フリガナ） | ✅ | テキスト | 例: ヤマダ |
| 名（フリガナ） | ✅ | テキスト | 例: タロウ |
| 希望勤務スタイル | - | チェックボックス（複数選択可） | リモート / ハイブリッド / 常駐 |
| 稼働可能時期 | - | 日付選択 | すぐに稼働可能な場合は空欄可 |
| 希望単価（月額） | - | 数値 | 万円単位 |

**設計意図**:
- 新規登録で入力済みの情報（氏名、電話番号、生年月日）は再度聞かない
- 営業活動に必要な最低限の情報のみ収集
- 離脱率を下げるため項目数を4項目に絞る

**送信データ**:
- `lastNameKana`, `firstNameKana`: フリガナ
- `desiredWorkStyle`: 希望勤務スタイル（配列）
- `availableFrom`: 稼働可能時期
- `desiredRate`: 希望単価

**リダイレクト先**: `/me`（マイページ）

---

### 5. マイページ（/me）

**目的**: 詳細なプロフィール情報の入力・管理

#### 5.1 プロフィール（基本情報）

| 項目 | 必須 | 入力形式 | 備考 |
|------|:----:|----------|------|
| 姓 | ✅ | テキスト | - |
| 名 | ✅ | テキスト | - |
| 姓（フリガナ） | - | テキスト | - |
| 名（フリガナ） | - | テキスト | - |
| メールアドレス | ✅ | Email | - |
| 生年月日 | - | 日付選択 | - |
| 電話番号 | - | Tel | - |
| 郵便番号 | - | テキスト | 入力で住所補完 |
| 住所 | - | テキスト | - |

#### 5.2 職歴・資格

| 項目 | 必須 | 入力形式 | 備考 |
|------|:----:|----------|------|
| 言語・ツールの経験 | ✅ | テキストエリア | JavaScript, React, AWS など |
| 主な実績・PR・職務経歴・資格 | ✅ | テキストエリア | 詳細に記載 |
| 経歴書アップロード | - | ファイル | 最大10ファイル |
| ポートフォリオ・GitHubのURL | - | URL | - |

#### 5.3 希望条件

| 項目 | 必須 | 入力形式 | 備考 |
|------|:----:|----------|------|
| 稼働可能時期 | ✅ | 日付選択 | - |
| 希望単価（月額） | - | 数値 | 万円単位 |
| 希望勤務日数 | ✅ | プルダウン | 週1〜週5、案件条件に従う |
| 希望出社頻度 | - | プルダウン | 週1〜週5、案件条件に従う、なし |
| 希望勤務スタイル | - | チェックボックス | リモート / ハイブリッド / 常駐 |
| 希望作業時間（1日あたり） | ✅ | プルダウン | 2時間〜8時間以上、案件条件に従う |
| 希望案件・作業内容 | - | テキストエリア | - |
| NG企業 | - | テキストエリア | - |
| その他要望 | - | テキストエリア | - |

---

## 必須項目まとめ

### 登録フロー全体での必須項目

| ステップ | 必須項目 |
|----------|----------|
| 新規登録 | 氏名、メール、パスワード、電話番号、生年月日、利用規約同意 |
| 中間ページ | フリガナ（姓・名） |
| マイページ | 氏名、メール、言語・ツール、実績・職歴、稼働可能時期、希望勤務日数、希望作業時間 |

### 必須項目の根拠（基本設計書より）

| 項目 | 根拠 |
|------|------|
| 氏名 | 営業側から直接オファーを出すために必要 |
| フリガナ | 営業が電話する際に必要 |
| 言語・ツールの経験 | AIマッチングに使用 |
| 主な実績・PR・職務経歴 | AIマッチングに使用 |
| 希望勤務日数 | プログラムでマッチング |
| 稼働可能時期 | プログラムでマッチング |
| 希望作業時間 | プログラムでマッチング（1日あたり可能作業時間） |

---

## ログイン保持機能

### 仕様

| 項目 | 内容 |
|------|------|
| 有効期間 | 30日間 |
| 適用条件 | 「ログイン状態を保持」にチェックを入れた場合 |
| 対象 | 新規登録時、ログイン時 |

### 実装詳細

1. **新規登録時**:
   - `rememberMe`フラグをAPIに送信
   - メール認証後のコールバックで30日間のセッションを設定

2. **ログイン時**:
   - `rememberMe`フラグをAPIに送信
   - セッションの`expiresAt`を30日後に設定

---

## 関連ファイル

| ファイル | 役割 |
|----------|------|
| `app/auth/signup/page.tsx` | 新規登録画面 |
| `app/auth/complete-profile/page.tsx` | プロフィール完成画面（中間ページ） |
| `app/me/page.tsx` | マイページ |
| `components/profile-form.tsx` | プロフィール編集フォーム |
| `components/work-history-form.tsx` | 職歴・資格編集フォーム |
| `components/preferences-form.tsx` | 希望条件編集フォーム |
| `app/api/auth/signup-with-email/route.ts` | サインアップAPI |
| `app/api/auth/callback/route.ts` | メール認証コールバック |
| `app/api/me/route.ts` | プロフィール更新API |

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2025-12-04 | 初版作成。中間ページの項目を4項目に絞り、マイページの必須項目を基本設計書に合わせて修正。希望作業時間を追加。 |

