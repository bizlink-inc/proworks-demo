# proworks-app テストケース一覧

このドキュメントは、アプリケーションの基本的な操作と、その操作に対して何が起こるのかを網羅的にまとめたものです。

---

## 目次

| No | カテゴリ | 項目数 |
|----|----------|--------|
| [1. ユーザー登録・認証](#1-ユーザー登録認証) | 新規登録、ログイン、パスワードリセット、メール変更、ログアウト | 15 |
| [2. プロフィール管理](#2-プロフィール人材情報管理) | プロフィール取得・更新、ファイル操作 | 9 |
| [3. 案件管理](#3-案件管理) | 案件一覧、検索・フィルター、ソート、詳細 | 11 |
| [4. 応募管理](#4-応募管理) | 応募、履歴確認、取消し | 8 |
| [5. 推薦・マッチング](#5-推薦マッチング) | おすすめ案件、マッチングスコア | 3 |
| [6. お問い合わせ](#6-お問い合わせ) | フォーム送信 | 1 |
| [7. 退会](#7-退会) | 退会手続き、退会後の動作 | 2 |
| [8. 管理者機能](#8-管理者機能) | 認証、AIマッチング、担当者おすすめ、バッチ設定 | 8 |
| [9. アプリ内通知・バッジ](#9-アプリ内通知バッジ) | バナー、ドロップダウン、各種通知、既読処理 | 26 |
| [10. Lambdaバッチ処理](#10-lambdaバッチ処理) | スコアマッチ、閾値変更、インクリメンタル計算、面談リマインド | 30 |
| [11. Webhook](#11-webhook外部連携) | 案件作成時の処理 | 1 |
| [12. Slack通知一覧](#12-slack通知一覧まとめ) | 全Slack通知のまとめ | 4 |
| [13. メール送信一覧](#13-メール送信一覧まとめ) | 全メール送信のまとめ | 10 |
| **合計** | | **約128項目** |

---

## 1. ユーザー登録・認証

### 1.1 新規ユーザー登録

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 1.1.1 | メールアドレス、パスワード、姓名、電話番号、生年月日を入力して登録ボタンを押す | - userテーブルにレコードが作成される<br>- 入力したメールアドレスに確認メールが送信される<br>- サインアップ情報がクッキーに保存される（1時間） |
| 1.1.2 | 確認メール内のリンクをクリックする | - メールアドレスが確認済みになる<br>- Kintone人材DBに新規レコードが作成される<br>- **Slack通知が送信される（新規登録通知）**<br>- プロフィール入力ページにリダイレクトされる |
| 1.1.3 | 既に登録済みのメールアドレスで登録しようとする | - エラーメッセージが表示される<br>- レコードは作成されない |
| 1.1.4 | 無効なメールアドレス形式で登録しようとする | - バリデーションエラーが表示される |
| 1.1.5 | パスワードが6文字未満で登録しようとする | - バリデーションエラーが表示される |

### 1.2 ログイン

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 1.2.1 | 正しいメールアドレスとパスワードでログインする | - セッションが作成される<br>- ダッシュボードにリダイレクトされる |
| 1.2.2 | 間違ったパスワードでログインする | - エラーメッセージが表示される<br>- ログインできない |
| 1.2.3 | 存在しないメールアドレスでログインする | - エラーメッセージが表示される<br>- ログインできない |
| 1.2.4 | 退会済みユーザーでログインしようとする | - ログインがブロックされる<br>- 退会済みである旨のエラーが表示される |
| 1.2.5 | メール未確認のユーザーでログインしようとする | - ログインできない<br>- メール確認を促すメッセージが表示される |

### 1.3 パスワードリセット

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 1.3.1 | パスワードリセットを申請する | - リセットリンク付きのメールが送信される<br>- リンクは1時間有効 |
| 1.3.2 | リセットリンクをクリックして新しいパスワードを設定する | - パスワードが更新される<br>- ログインページにリダイレクトされる |
| 1.3.3 | 期限切れのリセットリンクをクリックする | - エラーメッセージが表示される<br>- パスワードは変更されない |

### 1.4 メールアドレス変更

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 1.4.1 | 新しいメールアドレスを入力して変更申請する | - 新しいメールアドレスに確認メールが送信される |
| 1.4.2 | 確認リンクをクリックする | - メールアドレスが新しいものに更新される<br>- 正常に変更完了のメッセージが表示される |

### 1.5 ログアウト

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 1.5.1 | ログアウトボタンを押す | - セッションが削除される<br>- ログインページにリダイレクトされる |

---

## 2. プロフィール（人材情報）管理

### 2.1 プロフィール取得

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 2.1.1 | マイページを開く | - Kintone人材DBから自分のプロフィール情報が取得される<br>- 登録済みの情報が表示される |
| 2.1.2 | 退会済みユーザーがマイページを開こうとする | - エラーが返される（withdrawn: true） |

### 2.2 プロフィール更新

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 2.2.1 | 基本情報（氏名、電話番号等）を更新する | - Kintone人材DBのレコードが更新される |
| 2.2.2 | スキル情報（言語・ツール）を更新する | - Kintone人材DBのレコードが更新される |
| 2.2.3 | 希望条件（単価、稼働時期等）を更新する | - Kintone人材DBのレコードが更新される |
| 2.2.4 | 職務経歴書をアップロードする | - ファイルがアップロードされる<br>- Kintone人材DBに添付される |
| 2.2.5 | 必須項目をすべて入力してプロフィールを完成させる（初めて） | - プロフィールが更新される<br>- **Slack通知が送信される（プロフィール完成通知）** |
| 2.2.6 | すでにプロフィール完成済みの状態で更新する | - プロフィールが更新される<br>- Slack通知は送信されない（初回のみ） |

### 2.3 ファイル操作

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 2.3.1 | 職務経歴書ファイルをアップロードする | - ファイルがアップロードされる<br>- ファイルURLがプロフィールに保存される |
| 2.3.2 | 職務経歴書ファイルをダウンロードする | - ファイルがダウンロードされる |
| 2.3.3 | 職務経歴書ファイルを削除する | - ファイルが削除される<br>- プロフィールからファイル情報が削除される |

---

## 3. 案件管理

### 3.1 案件一覧取得

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 3.1.1 | 案件一覧ページを開く | - 募集中の案件一覧が表示される<br>- クローズ済み案件は表示されない |
| 3.1.2 | 応募済みの案件一覧を開く | - 自分が応募した案件のみが表示される |

### 3.2 案件検索・フィルター

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 3.2.1 | キーワードで検索する | - 案件名、概要、スキル等にキーワードを含む案件が表示される<br>- 複数キーワードはAND検索 |
| 3.2.2 | リモート可否でフィルターする | - 選択した条件（フルリモート/リモート併用/常駐）に一致する案件が表示される |
| 3.2.3 | 職種でフィルターする | - 選択した職種の案件のみが表示される |
| 3.2.4 | 勤務地エリアでフィルターする | - 選択したエリアの案件のみが表示される |
| 3.2.5 | 最寄駅でフィルターする | - 選択した最寄駅の案件のみが表示される |

### 3.3 案件ソート

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 3.3.1 | おすすめ順でソートする | - 担当者おすすめ → AIマッチ → 適合スコア順で表示される |
| 3.3.2 | 新着順でソートする | - 作成日時が新しい順に表示される |
| 3.3.3 | 単価順（高い順）でソートする | - 掲載単価が高い順に表示される |

### 3.4 案件詳細

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 3.4.1 | 案件詳細ページを開く | - 案件の詳細情報が表示される |
| 3.4.2 | 応募済みの案件詳細を開く | - 案件詳細が表示される<br>- 応募済みである旨が表示される |

---

## 4. 応募管理

### 4.1 案件応募

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 4.1.1 | 案件に応募する | - Kintone応募履歴DBにレコードが作成される<br>- 対応状況が「応募済み」に設定される<br>- **応募完了メールが送信される**<br>- **Slack通知が送信される（応募通知）** |
| 4.1.2 | プロフィール必須項目が未入力の状態で応募しようとする | - エラーが表示される<br>- 応募できない<br>- プロフィール入力を促すメッセージが表示される |
| 4.1.3 | 同じ案件に重複して応募しようとする | - エラーが表示される<br>- 重複応募はできない |
| 4.1.4 | 応募後に案件一覧を開く | - 応募した案件は通常の案件一覧から非表示になる |
| 4.1.5 | 応募後に応募済み案件一覧を開く | - 応募した案件が応募済み一覧に表示される |

### 4.2 応募履歴確認

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 4.2.1 | 応募履歴ページを開く | - 自分の応募履歴が表示される（3ヶ月以内） |
| 4.2.2 | 応募の詳細を確認する | - 応募日時、案件情報、対応状況が表示される |

### 4.3 応募取消し

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 4.3.1 | 応募を取消しする | - 対応状況が「応募取消し」に更新される<br>- **応募取消しメールが送信される** |

---

## 5. 推薦・マッチング

### 5.1 おすすめ案件

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 5.1.1 | おすすめ案件を確認する | - 担当者おすすめ案件が表示される<br>- AIマッチ案件が表示される<br>- 適合スコアが高い案件が表示される |
| 5.1.2 | 新着おすすめ通知を確認する | - 7日以内の新着おすすめ案件が表示される |

### 5.2 マッチングスコア

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 5.2.1 | 案件一覧でスコアを確認する | - 自分の適合スコアが表示される<br>- 担当者おすすめ・AIマッチのバッジが表示される |

---

## 6. お問い合わせ

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 6.1 | お問い合わせフォームを送信する | - Kintone問い合わせDBにレコードが作成される<br>- お問い合わせ確認メールが送信される |

---

## 7. 退会

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 7.1 | 退会手続きを行う（退会理由を入力して確定） | - Kintone問い合わせDBに「退会申請」レコードが作成される<br>- Kintone人材DBのSTフィールドが「退会」に更新される<br>- **退会完了メールが送信される**<br>- ログアウトされる |
| 7.2 | 退会後にログインしようとする | - ログインがブロックされる |

---

## 8. 管理者機能

### 8.1 管理者認証

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 8.1.1 | 管理者としてログインする | - 管理者セッションが作成される<br>- 管理画面にアクセスできる |
| 8.1.2 | 管理者としてログアウトする | - 管理者セッションが削除される |

### 8.2 AIマッチング

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 8.2.1 | AIマッチングを実行する | - 選定した人材に対してGemini AIで評価が実行される<br>- 評価結果がKintone推薦DBに保存される<br>- **AIマッチ通知メールが送信される** |
| 8.2.2 | マッチング結果を確認する | - AIマッチングの結果一覧が表示される |

### 8.3 担当者おすすめ

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 8.3.1 | 担当者おすすめを設定する | - Kintone推薦DBのおすすめフラグが「おすすめ」に更新される<br>- **担当者おすすめ通知メールが送信される** |
| 8.3.2 | 担当者おすすめを解除する | - Kintone推薦DBのおすすめフラグが空白に更新される |

### 8.4 バッチ設定

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 8.4.1 | スコア閾値を変更する | - appSettingsテーブルの設定が更新される<br>- マッチング抽出の閾値が変更される |
| 8.4.2 | 最大件数を変更する | - appSettingsテーブルの設定が更新される<br>- マッチング抽出の最大件数が変更される |

---

## 9. アプリ内通知・バッジ

### 9.1 アナウンスメントバナー（帯状通知）

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 9.1.1 | 掲載期間内のお知らせがある状態でページを開く | - ページ上部に帯状のバナーが表示される<br>- 形式: 【掲載開始日】通知内容 |
| 9.1.2 | 複数のお知らせがある場合 | - 1件ずつ順番に表示される<br>- 「n件中m件目」の表示がある |
| 9.1.3 | バナーの×ボタンをクリックする | - バナーがフェードアウトして閉じる<br>- ローカルストレージに閉じたIDが保存される<br>- 次のお知らせがあれば表示される |
| 9.1.4 | 閉じたお知らせがある状態で再度ページを開く | - 閉じたお知らせは表示されない |
| 9.1.5 | 掲載期間外のお知らせのみの場合 | - バナーは表示されない |

### 9.2 通知ドロップダウン（ベルアイコン）

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 9.2.1 | 未読通知がある状態でヘッダーを確認する | - ベルアイコンに赤い通知バッジが表示される<br>- バッジに未読件数が表示される（99件以上は「99+」） |
| 9.2.2 | ベルアイコンをクリックする | - 通知ドロップダウンが開く<br>- 通知一覧が表示される |
| 9.2.3 | 通知がない状態でベルアイコンを確認する | - 通知バッジは表示されない |
| 9.2.4 | 通知をクリックする | - 該当のページ/モーダルに遷移する<br>- 通知が既読になる（一覧から消える） |
| 9.2.5 | 別のユーザーでログインする | - 前のユーザーの通知はクリアされる<br>- 新しいユーザーの通知が読み込まれる |

### 9.3 おすすめ案件通知（プログラムマッチ）

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 9.3.1 | 推薦レコードが作成されてから7日以内にログインする | - 通知ドロップダウンに新着おすすめ案件が表示される |
| 9.3.2 | おすすめ案件の通知をクリックする | - 案件詳細モーダルが開く<br>- 通知が既読になる |
| 9.3.3 | 推薦レコード作成から8日以上経過後にログインする | - その推薦は通知に表示されない（7日以内のみ） |

### 9.4 担当者おすすめ通知

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 9.4.1 | 担当者おすすめが設定された後にログインする | - 通知ドロップダウンに「担当者からあなたに向けた案件オファーが届いています」が表示される |
| 9.4.2 | 担当者おすすめ通知の【オファーを確認する】をクリックする | - 案件詳細モーダルが開く<br>- 通知が既読になる |
| 9.4.3 | 担当者おすすめが解除された場合 | - 該当の通知は表示されなくなる |

### 9.5 プロフィール未入力警告

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 9.5.1 | 必須項目が未入力の状態でログインする | - 通知ドロップダウンに「マイページの必須項目が未記入です」が表示される<br>- 未入力のタブ（プロフィール/職歴・資格/希望条件）が案内される |
| 9.5.2 | プロフィール未入力通知をクリックする | - 該当のマイページタブに遷移する |
| 9.5.3 | 通知を閉じて24時間以内に再度ログインする | - プロフィール未入力通知は表示されない |
| 9.5.4 | 通知を閉じて24時間以上経過後に再度ログインする | - プロフィール未入力通知が再度表示される |
| 9.5.5 | 必須項目をすべて入力した後にログインする | - プロフィール未入力通知は表示されない |

### 9.6 面談予定確定通知

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 9.6.1 | 応募の対応状況が「面談予定」に変更された後にアプリを開く | - 通知ドロップダウンに「面談予定が確定しました」が表示される<br>- **面談予定確定メールが送信される** |
| 9.6.2 | 面談予定確定通知の【応募済み案件】をクリックする | - 応募済み案件ページに遷移する<br>- 該当の案件が表示される |
| 9.6.3 | 同じ案件で再度「面談予定」に変更された場合 | - 重複してメールは送信されない（送信済みIDで管理） |

### 9.7 通知の既読・クリア

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 9.7.1 | 通知をクリックして確認する | - その通知が既読になる<br>- ローカルストレージの既読セットに追加される<br>- 通知バッジの件数が減る |
| 9.7.2 | すべての通知を確認する | - 通知バッジが非表示になる |

---

## 10. Lambdaバッチ処理

### 10.1 スコアマッチバッチ処理（基本動作）

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 10.1.1 | バッチ処理が毎日JST 02:00に実行される | - Step Functionsが起動される<br>- GetJobs → ProcessJob(並列) → UpdateState の順で実行される |
| 10.1.2 | アクティブな案件と人材の組み合わせでスコアが計算される | - 案件の「職種_ポジション」「スキル」からキーワード抽出<br>- 人材の「職種」「言語_ツール」「主な実績_PR_職務経歴」で出現回数をカウント<br>- 合計出現回数がスコアとして記録される |
| 10.1.3 | スコアが閾値以上の場合 | - Kintone推薦DBに推薦レコードが作成される |
| 10.1.4 | スコアが閾値未満の場合 | - 推薦レコードは作成されない<br>- 既存の推薦レコードがあれば削除される |
| 10.1.5 | 退会済みの人材がいる場合 | - 該当人材の推薦レコードは削除される |
| 10.1.6 | 非アクティブ（クローズ）の案件がある場合 | - 該当案件の推薦レコードは処理対象外 |

### 10.2 閾値変更時の動作

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 10.2.1 | 閾値を上げる（例: 3 → 5） | - 「閾値上昇削除のみ」モードで実行される<br>- 新たなスコア計算は実行されない（高速処理）<br>- スコア < 新閾値のレコードが削除される |
| 10.2.2 | 閾値を上げた場合、AIマッチ実行済みのレコード | - 保護対象として削除されない |
| 10.2.3 | 閾値を上げた場合、担当者おすすめのレコード | - 保護対象として削除されない |
| 10.2.4 | 閾値を下げる（例: 5 → 3） | - 「フル計算」モードで実行される<br>- 全案件・全人材の組み合わせを再計算<br>- 新しい閾値以上のマッチが推薦レコードとして作成される |
| 10.2.5 | 閾値を下げた場合、以前削除されていたペア | - 新閾値以上のスコアであれば推薦レコードが復活（新規作成） |

### 10.3 インクリメンタル計算

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 10.3.1 | 前回バッチ以降に人材情報が更新された場合 | - 該当人材に関連するスコアが再計算される |
| 10.3.2 | 前回バッチ以降に案件情報が更新された場合 | - 該当案件に関連するスコアが再計算される |
| 10.3.3 | 前回バッチ以降に更新がない人材・案件の組み合わせ | - 既存スコアが閾値以上であればスキップ（計算省略）<br>- 既存スコアがそのまま保持される |
| 10.3.4 | 初回実行または前回バッチ日時が不明な場合 | - 「フル計算」モードで全組み合わせを計算 |

### 10.4 推薦レコードの作成・更新・削除

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 10.4.1 | 新規のマッチング（既存レコードなし、スコア≧閾値） | - Kintone推薦DBに新規レコードが作成される |
| 10.4.2 | 既存レコードのスコアが変更された場合 | - 推薦レコードの適合スコアが更新される |
| 10.4.3 | 既存レコードのスコアが閾値未満になった場合 | - 推薦レコードが削除される（保護対象除く） |
| 10.4.4 | AIマッチ実行済みのレコードが閾値未満になった場合 | - 保護対象として削除されない |
| 10.4.5 | 担当者おすすめのレコードが閾値未満になった場合 | - 保護対象として削除されない |
| 10.4.6 | 1案件あたりの推薦数がmaxPerJobを超える場合 | - スコア上位のmaxPerJob件のみが保持される |

### 10.5 バッチ状態の更新

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 10.5.1 | バッチ処理が正常終了した場合 | - app_settingsテーブルのlastBatchTimeが更新される<br>- lastThresholdが実行時の閾値で更新される |
| 10.5.2 | 次回バッチ実行時 | - lastBatchTimeを参照してインクリメンタル計算が行われる<br>- lastThresholdと現在の閾値を比較して実行モードが決定される |

### 10.6 面談リマインドバッチ処理

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 10.6.1 | バッチ処理が毎日JST 10:00に実行される | - Lambda関数が起動される |
| 10.6.2 | 翌日に面談予定がある場合 | - 該当する人材と案件情報を取得<br>- **Slack通知が送信される（面談リマインド）** |
| 10.6.3 | 翌日に面談予定がない場合 | - Slack通知は送信されない |

### 10.7 手動実行（refresh-recommendations.ts）

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 10.7.1 | `npx tsx scripts/refresh-recommendations.ts` を実行 | - Lambdaと同じロジックでスコア計算が実行される |
| 10.7.2 | `--threshold 5` オプションで実行 | - 指定した閾値（5）でスコア計算が実行される |
| 10.7.3 | `--full` オプションで実行 | - インクリメンタル計算をスキップしてフル計算が実行される |
| 10.7.4 | `--dry-run` オプションで実行 | - 実際の変更は行わず、処理結果のプレビューのみ表示される |

---

## 11. Webhook（外部連携）

| No | 操作 | 期待される結果 |
|----|------|----------------|
| 11.1 | 案件が作成されたとき（Kintone Webhook） | - 新規案件のマッチング処理が実行される |

---

## 12. Slack通知一覧（まとめ）

| No | トリガー | 通知内容 |
|----|----------|----------|
| 12.1 | 新規ユーザー登録（メール確認完了時） | 姓名、メール、電話、登録日時、人材DBリンク |
| 12.2 | プロフィール完成（初回のみ） | 姓名、メール、人材DBリンク |
| 12.3 | 案件応募 | ユーザー氏名、案件タイトル、人材DB・案件DBリンク |
| 12.4 | 面談リマインド（日次バッチ） | 翌日の面談予定一覧 |

---

## 13. メール送信一覧（まとめ）

| No | トリガー | メール内容 |
|----|----------|------------|
| 13.1 | 新規登録時 | メールアドレス確認リンク |
| 13.2 | パスワードリセット申請時 | パスワードリセットリンク |
| 13.3 | メールアドレス変更申請時 | 変更確認リンク |
| 13.4 | 案件応募時 | 応募完了通知 |
| 13.5 | 応募取消し時 | 応募取消し通知 |
| 13.6 | 退会時 | 退会完了通知 |
| 13.7 | お問い合わせ時 | お問い合わせ確認 |
| 13.8 | AIマッチ実行時 | AIマッチ通知 |
| 13.9 | 担当者おすすめ設定時 | 担当者おすすめ通知 |
| 13.10 | 面談予定確定時 | 面談予定確定通知 |

---

## 補足: 環境別動作

### 開発環境（ローカル）
- **メール送信**: コンソール出力
- **Slack通知**: コンソール出力（`📢 [Slack通知 - 開発環境]`）
- **キャッシュ**: メモリ内キャッシュ（5分）

### 本番環境
- **メール送信**: Amazon SES
- **Slack通知**: Slack Incoming Webhook
- **キャッシュ**: Redis + メモリキャッシュ

---

## テスト実施時の注意事項

1. **テストデータの準備**: `npm run seed` でテストデータを生成可能
2. **キャッシュクリア**: `/api/dev/clear-cache` でキャッシュをクリア可能
3. **Kintone連携**: テスト環境用のKintoneアプリを使用すること
4. **退会テスト後の復帰**: STフィールドを手動で空にする必要あり
