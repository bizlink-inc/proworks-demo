# 🚀 ProWorks 技術スタック提案書（v1.3）

## 1. システム構成概要

```
【フロントエンド】
Next.js 16 + React + TypeScript + Tailwind CSS
↓ API通信
【BFF層（Route Handlers / API Routes）】
Next.js 内部API層（Better Auth認証・kintone連携を仲介）
↓
【バックエンド】
kintone REST API（業務データ管理）
＋
Cloud Run（Next.js/Better Authホスティング）
＋
マネージドPostgreSQL（認証・セッション・ユーザー情報管理）
```

---

## 2. 採用技術スタック一覧

### フロントエンド

| 技術 | 用途 | 選定理由 |
| ---- | ---- | -------- |
| **Next.js 16** | Webアプリケーションフレームワーク | 最新のTurbopack・キャッシュ機構対応。React 19対応済み。高速・安定。 |
| React 18 | UI構築ライブラリ | 業界標準で保守性が高い。 |
| TypeScript | 型付き言語 | 型安全によりバグを早期防止。中長期開発に適する。 |
| Tailwind CSS | CSSフレームワーク | デザイン統一と開発効率を両立。 |
| **Better Auth** | 認証ライブラリ | Auth.jsの後継。軽量・柔軟でPostgreSQLとの親和性が高い。 |

---

### バックエンド

| 技術 | 用途 | 選定理由 |
| ---- | ---- | -------- |
| **Cloud Run（東京リージョン）** | Next.js/Better Authホスティング | 国内通信でkintoneとの往復が安定。課金見通しが明瞭。Vercelより転送料が可視化しやすい。 |
| **マネージドPostgreSQL** | 認証・セッションDB | スキーマ設計の柔軟性と安定性を両立。スケーラブルな構成が可能。 |
| **kintone REST API** | 業務データ永続化・管理 | 既存社内知見を活用し、管理UI開発を不要化。 |
| **@kintone/rest-api-client** | kintone接続ライブラリ | 公式ライブラリで信頼性・型安全性が高い。 |

---

### インフラ・ホスティング

| 技術 | 用途 | 選定理由 |
| ---- | ---- | -------- |
| Cloud Run | コンテナホスティング | Google Cloud管理下で自動スケール。国内リージョン対応。 |
| GitHub | ソース管理 | 業界標準のバージョン管理。Cloud Buildとの連携が容易。 |

---

### セキュリティ

| 対策 | 実装方法 | 目的 |
| ---- | -------- | ---- |
| HTTPS通信 | Cloud Run標準対応 | 通信の暗号化 |
| 認証データ管理 | Better Auth + PostgreSQL | セッション・パスワードを安全に分離管理 |
| kintone接続 | API Token + ドメイン制限 | 外部アクセス制御 |
| 環境変数管理 | Secret Manager + Cloud Build | APIキー等を安全に保持 |
| セッション管理 | JWT + 有効期限付きCookie | 不正アクセス防止 |

---

## 3. システムアーキテクチャ概要

```
[ユーザー]
   ↓
[Next.js (Cloud Run)]
 ├─ UI (React, Tailwind)
 ├─ Better Auth (PostgreSQL)
 └─ API Routes（BFF層）
        ↓
    [kintone REST API]
        ↓
    [kintoneアプリ群]
```

- kintoneには認証情報を保存せず、`external_user_id`（外部参照キー）のみ保持。  
- 認証・セッション情報はPostgreSQL側で管理し、データ安全性とスケーラビリティを確保。  
- kintoneは業務データ管理に専念し、バックオフィスのメンテナンス性を高める。  

---

## 4. kintoneアプリ構成

| アプリ名 | 概要 | 主な項目 |
| -------- | ---- | -------- |
| **案件マスタ** | 案件情報を一元管理 | 案件名、企業名、単価、公開フラグ |
| **人材マスタ** | 登録エンジニア情報を管理 | 名前、スキル、ステータス、external_user_id |
| **応募履歴** | 案件と人材の紐付け管理 | 案件ID、人材ID、ステータス、メモ |

※ kintone APIの1日あたりのリクエスト上限は、**1アプリにつき10,000回**（2025年現在）

---

## 5. セキュリティ設計

| 項目 | 実装 | リスク軽減効果 |
| ---- | ---- | --------------- |
| 通信暗号化 | HTTPS (TLS1.3) | 通信傍受を防止 |
| 認証情報分離 | kintone非保存・PostgreSQL管理 | パスワード漏洩リスクを回避 |
| セッション | JWT + Cookie | 不正ログイン防止 |
| APIキー管理 | Secret Manager | 認証情報の安全な保管 |
| CORS制御 | Cloud Run + kintone設定 | 外部からの不正呼び出し防止 |

**準拠規格**
- 個人情報保護法  
- ISO27001（kintone）  
- SOC 2 Type II（Google Cloud）

---

## 6. リスクと対策

| リスク | 影響度 | 発生確率 | 対策 |
| ------ | -------- | -------- | ---- |
| kintone API制限到達 | 中 | 低 | 1アプリあたり1日10,000リクエストを上限とし、キャッシュ・バッチ処理を適用 |
| Cloud Run無料枠超過 | 低 | 低 | 使用量モニタリング・費用警告設定を導入 |
| DBスキーマ変更 | 中 | 中 | Prisma Migrateによるバージョン管理 |
| システム障害 | 高 | 低 | Cloud Logging + アラート通知で早期検知 |

---

## 7. まとめ

**本提案の強み**

1. **Next.js 16採用による将来互換性・高速化**
2. **Better Auth + PostgreSQLによる安全な認証管理**
3. **Cloud Run + kintoneによる国内安定通信構成**
4. **セキュリティ・運用コスト双方で最適化**

**推奨アクション**
1. 本v1.3構成での開発承認  
2. kintoneアプリの要件確定  
3. Cloud Run環境セットアップ着手

---

**作成日**：2025年10月24日  
**作成者**：佐藤（開発担当）  
**バージョン**：1.3
